function splitBlock(n,t,i,r){var nt=this,u=[],o,w,f,e;this.diviDefaults={fbl0:800,blockSize:5e4,scaleNum:1.8};this.diviOptions=$.extend({},this.diviDefaults,i);typeof this.diviOptions.src000=="undefined"&&(this.diviOptions.src000=n+"@"+this.diviOptions.fbl0+"h_"+this.diviOptions.fbl0+"w_0e_1l.src");var b=Math.round(t.size/this.diviOptions.blockSize),y=Math.max(t.width,t.height),k=Math.min(t.width,t.height),v=Math.round(Math.log(y/this.diviOptions.fbl0)/Math.log(this.diviOptions.scaleNum));v<1&&(v=1);var p=t.width/t.height,d=Math.round(y/k),g=t.width>t.height?!0:!1,s,h,c=Math.round(Math.sqrt(b/d)),l,a;for(o=v;o>=1;o--){for(u[o]=[],w=Math.ceil(100/Math.pow(1.8,v-o)),c<1&&(c=1),g?(s=c,h=s*p,h=h<1?1:Math.ceil(h)):(h=c,s=h/p,s=s<1?1:Math.ceil(s)),f=0;f<h;f++)for(u[o][f]=[],e=0;e<s;e++)l=Math.ceil(t.width/h),a=Math.ceil(t.height/s),u[o][f][e]={},u[o][f][e].src=n+"@"+f*l+"-"+e*a+"-"+l+"-"+a+"a_"+w+"p_100q.src",u[o][f][e].x=f*l,u[o][f][e].y=e*a,u[o][f][e].w=f==h-1?t.width-l*f:l,u[o][f][e].h=e==s-1?t.height-a*e:a;c=Math.round(c/this.diviOptions.scaleNum)}return u[0]=[],u[0][0]=[],u[0][0][0]={},u[0][0][0].src=this.diviOptions.src000,u[0][0][0].x=0,u[0][0][0].y=0,u[0][0][0].w=t.width,u[0][0][0].h=t.height,u[0][0][0].maxScaleTimes=v,u[0][0][0].originalURL=n,r&&r(u),u}(function(n,t,i){function f(f,s,h){function w(){c.options.mode="img";c.canvas=i.createElement("div");c.canvas.style.backgroundImage="url("+s[0][0][0].src+")";c.canvas.style.backgroundSize="100% 100%"}var c=this,l,a,p,v,y,b,k;if(c.vInterval="undefined",c.$layer=n(f),c.imgLevels=s,c.defaults={fullWidth:s[0][0][0].w,fullHeight:s[0][0][0].h,initSize:.8,scaleNum:1.8,overScaleTimes:2,whiteBorderSize:100,thumbnail:!0,thumbnailSize:160,mode:"img"},c.canTransform="MozTransform"in i.documentElement.style||"WebkitTransform"in i.documentElement.style||"OTransform"in i.documentElement.style||"msTransform"in i.documentElement.style?!0:!1,c.options=n.extend({},c.defaults,h),c.options.mode=="canvas")try{c.canvas=i.createElement("canvas");c.canvas.crossOrigin="anonymous";c.ctx=c.canvas.getContext("2d")}catch(d){w()}else w();for(c.imgs=[],l=0;l<s.length;l++)for(c.imgs[l]=[],a=0;a<s[l].length;a++)for(c.imgs[l][a]=[],p=0;p<s[l][a].length;p++)c.imgs[l][a][p]={};l--;c.LevelMax=l;c.containW=c.$layer.width();c.containH=c.$layer.height();c.options.mode=="canvas"?(c.canvas.width=c.containW,c.canvas.height=c.containH):(c.canvas.style.width=c.options.fullWidth+"px",c.canvas.style.height=c.options.fullHeight+"px");c.kgb=c.options.fullWidth/c.options.fullHeight;b=c.containW/c.containH;c.kgb>b?(v=c.containW*c.options.initSize,y=v/c.kgb):(y=c.containH*c.options.initSize,v=y*c.kgb);c.top=(c.containH-y)/2;c.left=(c.containW-v)/2;c.width=v;c.height=y;c.canvas.style.position="absolute";c.canvas.style.top=0;c.canvas.style.left=0;c.$layer.css("overflow","hidden");c.$layer.css("position")=="static"&&c.$layer.css("position","relative");c.scale=1;k=Math.max(c.options.fullWidth,c.options.fullHeight);c.maxScaleNum=Math.ceil(Math.max(c.options.fullWidth/c.containW,c.options.fullHeight/c.containH)*c.options.overScaleTimes);c.curLevel=0;c.initdraw();c.$layer.append(c.canvas);c.$canvas=n(c.canvas);c.$canvas.css({"-moz-transform-origin":"0 0","-webkit-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"});c.options.thumbnail&&c.initThumbnail();c.setCss();c.debounceWaitTime=40;c.$canvas.on(e,function(t){if(t.preventDefault(),c.vInterval!="undefined"&&(clearInterval(c.vInterval),c.vInterval="undefined"),typeof t.originalEvent.touches!="undefined"&&t.originalEvent.touches.length>1){n(i).off("touchmove touchend");return}var a=c.getxy(t),f=a.x,e=a.y,v=f,y=e,s=f,h=e,l=(new Date).getTime();n(i).off(u).on(u,o(function(n){n.preventDefault();var t=c.getxy(n),i=t.x,r=t.y;c.left=c.left+i-f;c.top=c.top+r-e;c.setCss();c.draw();f=i;e=r},c.debounceWaitTime,!1));n(i).off(r).on(r,function(t){var y,o,a,v;t.preventDefault();var b=c.getxy(t),k=b.x,d=b.y;if(c.left=c.left+k-f,c.top=c.top+d-e,c.setCss(),c.draw(),f=k,e=d,y=(new Date).getTime(),o=Math.abs(Math.round(Math.sqrt((f-s)*(f-s)+(e-h)*(e-h))))/(y-l),o>2){a=(f-s)/(y-l);v=(e-h)/(y-l);o=o/2;a=a/2;v=v/2;var g=0,nt=10,p=o/nt,w=Math.sqrt(p*p*a*a/o/o),tt=Math.sqrt(p*p*v*v/o/o);c.vInterval=setInterval(function(){g++;g>=nt&&(clearInterval(c.vInterval),c.draw());a>0?a-=w*.04:a+=w*.04;v>0?v-=tt*.04:v+=w*.04;c.left+=a*40;c.top+=v*40;c.setCss()},40)}n(i).off(u+" "+r)})});c.$layer.on("touchstart",function(n){var t=n.originalEvent.touches;if(t.length==2){n.preventDefault();var i=t[0].clientX,r=t[0].clientY,u=t[1].clientX,f=t[1].clientY,e=Math.sqrt((u-i)*(u-i)+(f-r)*(f-r));c.$layer.off("touchmove").on("touchmove",o(function(n){var t,o;if(n.preventDefault(),t=n.originalEvent.touches,t.length!=2){c.$layer.off("touchmove");return}i=t[0].clientX;r=t[0].clientY;u=t[1].clientX;f=t[1].clientY;o=Math.sqrt((u-i)*(u-i)+(f-r)*(f-r));o-e>1?(c.Scale(1.1),e=o):o-e<-1&&(c.Scale(.91),e=o)},c.debounceWaitTime,!1));c.$layer.on("touchend",function(n){n.preventDefault();c.$layer.off("touchmove touchend")})}});c.$layer.on("mousewheel DOMMouseScroll",function(n){n.preventDefault();var t=n.originalEvent.wheelDelta&&(n.originalEvent.wheelDelta>0?1:-1)||n.originalEvent.detail&&(n.originalEvent.detail>0?-1:1);typeof n.pageX!="undefined"?t>0?c.Scale(1.1,{x:n.pageX-c.$layer.offset().left,y:n.pageY-c.$layer.offset().top}):c.Scale(.9,{x:n.pageX-c.$layer.offset().left,y:n.pageY-c.$layer.offset().top}):t>0?c.Scale(1.1):c.Scale(.9)});c.$canvas.dblclick(function(n){n.preventDefault();typeof n.pageX!="undefined"?c.Scale(c.options.scaleNum,{x:n.pageX-c.$layer.offset().left,y:n.pageY-c.$layer.offset().top}):c.Scale(c.options.scaleNum)});t.onorientationchange=function(){setTimeout(function(){c.resize(c)},100)}}n.fn.cvszoom=function(n,t){return new f(this,n,t)};var o=function(n,t,i){var r,u=!1;return typeof i=="undefined"&&(i=!0),function(){var f=this,e=arguments;u?i&&(clearTimeout(r),r=setTimeout(function(){n.apply(f,e)},t)):(u=!0,setTimeout(function(){u=!1},t),clearTimeout(r),n.apply(f,e))}},e,r,u;"ontouchend"in i?(u="touchmove",e="touchstart",r="touchend",console.log("touch")):(u="mousemove",e="mousedown",r="mouseup",console.log("mouse"));f.prototype.initThumbnail=function(){function h(){t.$thumbnail.css({width:t.options.thumbnailSize+"px",height:t.options.thumbnailSize+"px"});t.$thumbnail.find(".previewbox>img").attr("src",t.imgLevels[0][0][0].src);t.kgb>1?(t.$preview.h=(t.options.thumbnailSize/t.kgb).toFixed(2),t.$thumbnail.find(".previewbox").css({width:t.options.thumbnailSize+"px",height:t.$preview.h+"px"}),t.$preview.w=t.options.thumbnailSize,f.css("width",t.$preview.w+"px"),f.css("height",t.$preview.h+"px")):(t.$preview.w=(t.options.thumbnailSize*t.kgb).toFixed(2),t.$thumbnail.find(".previewbox").css({width:t.$preview.w+"px",height:t.options.thumbnailSize+"px"}),t.$preview.h=t.options.thumbnailSize,f.css("width",t.$preview.w+"px"),f.css("height",t.$preview.h+"px"));t.$scalebrightbox.mw=t.options.thumbnailSize-t.$scalebrightbox.width()-60}function c(){var i=parseFloat(f[0].style.width),r=parseFloat(f[0].style.height),e=parseFloat(f.css("left"))+i+"px",n=f.css("top"),o=t.$preview.w-(parseFloat(f.css("left"))+i)+"px",u=f[0].style.height,s=f.css("left"),h=parseFloat(f.css("top"))+r+"px",c=t.$preview.h-(parseFloat(f.css("top"))+r)+"px";t.$thumbnail.find(".dimbox.top").css({left:0,top:0,width:"100%",height:n});t.$thumbnail.find(".dimbox.left").css({left:0,top:n,width:s,height:u});t.$thumbnail.find(".dimbox.right").css({left:e,top:n,width:o,height:u});t.$thumbnail.find(".dimbox.bottom").css({left:0,top:h,width:"100%",height:c})}var t=this,s='<div class="cvs_thumbnail" >',f;s+='<div class="huidi"><\/div>';s+='<div class="shang"><\/div>';s+='<div class="xia"><\/div>';s+='<div class="previewbox">';s+='<img src="" draggable="false" />';s+='<div class="brightbox"><\/div>';s+='<div class="dimbox top"><\/div>';s+='<div class="dimbox left"><\/div>';s+='<div class="dimbox right"><\/div>';s+='<div class="dimbox bottom"><\/div>';s+="<\/div>";s+='<span class="btn scalebrightbox"><\/span>';s+='<span class="btn closeButton">âœ•<\/span>';s+='<span class="btn smallButton">-<\/span>';s+='<span class="btn bigButton">+<\/span>';s+="<\/div>";t.$thumbnail=n(s);t.$layer.append(t.$thumbnail);t.$preview=t.$thumbnail.find(".previewbox");t.$scalebrightbox=t.$thumbnail.find(".scalebrightbox");f=t.$thumbnail.find(".brightbox");h();t.$thumbnail.find(".shang").on(e,function(f){f.preventDefault();var e=t.getxy(f),s=e.x,h=e.y;n(i).off(u).on(u,o(function(n){n.preventDefault();var i=t.getxy(n),r=i.x,u=i.y,f=parseFloat(t.$thumbnail.css("right"))-r+s,e=parseFloat(t.$thumbnail.css("top"))+u-h;t.$thumbnail.css({right:f+"px",top:e+"px"});s=r;h=u},t.debounceWaitTime,!1));n(i).off(r).on(r,function(t){t.preventDefault();n(i).off(u+" "+r)})});t.$thumbnail.find(".xia,.scalebrightbox").on(e,function(f){var s;f.preventDefault();var c=t.$thumbnail.position().left,h=t.getxy(f).x,e=h-c;e<30?e=30:e>t.$scalebrightbox.mw+30&&(e=t.$scalebrightbox.mw+30);t.$scalebrightbox.css("left",e+"px");s=1+(t.maxScaleNum-1)*(e-30)/t.$scalebrightbox.mw;t.Scale(s/t.scale);n(i).off(u).on(u,o(function(n){n.preventDefault();var r=t.getxy(n).x,i=parseFloat(t.$scalebrightbox.css("left"))-30+r-h;i<0?i=0:i>t.$scalebrightbox.mw&&(i=t.$scalebrightbox.mw);t.$scalebrightbox.css("left",i+30+"px");s=1+(t.maxScaleNum-1)*i/t.$scalebrightbox.mw;t.Scale(s/t.scale);h=r},t.debounceWaitTime,!1));n(i).off(r).on(r,function(t){t.preventDefault();n(i).off(u+" "+r)})});t.$thumbnail.find(".previewbox").on(e,function(e){var c=parseFloat(f[0].style.width),l=parseFloat(f[0].style.height),a=t.getxy(e),v=a.x,y=a.y,w=n(this);if(!(t.width<t.containW)||!(t.height<t.containH)){var p=w.offset(),s=v-p.left-c/2,h=y-p.top-l/2,b=s,k=h;t.left=-t.width*s/t.$preview.w;t.top=-t.height*h/t.$preview.h;s<=0?(s=0,t.left=-t.width*s/t.$preview.w+t.options.whiteBorderSize):c+s>=t.$preview.w&&(s=t.$preview.w-c,t.left=-t.width*s/t.$preview.w-t.options.whiteBorderSize);h<=0?(h=0,t.top=-t.height*h/t.$preview.h+t.options.whiteBorderSize):l+h>=t.$preview.h&&(h=t.$preview.h-l,t.top=-t.height*h/t.$preview.h-t.options.whiteBorderSize);f.css({top:h+"px",left:s+"px"});t.setCss();t.draw();n(i).off(u).on(u,o(function(n){if(n.preventDefault(),!(t.width<t.containW)||!(t.height<t.containH)){var u=t.getxy(n),e=u.x,o=u.y,i=b+e-v,r=k+o-y;i<=0?(i=-1,t.left=t.options.whiteBorderSize):c+i>=t.$preview.w?(i=t.$preview.w-c+1,t.left=-t.width+t.containW-t.options.whiteBorderSize):t.left=-t.width*i/t.$preview.w;r<=0?(r=-1,t.top=t.options.whiteBorderSize):l+r>=t.$preview.h?(r=t.$preview.h-l+1,t.top=-t.height+t.containH-t.options.whiteBorderSize):t.top=-t.height*r/t.$preview.h;f.css({top:r+"px",left:i+"px"});t.setCss();t.draw()}},t.debounceWaitTime,!1));n(i).off(r).on(r,function(t){t.preventDefault();n(i).off(u+" "+r)})}});t.setThumbnail=function(){function i(){var n=(t.scale-1)*t.$scalebrightbox.mw/(t.maxScaleNum-1);t.$scalebrightbox.css({left:n+30+"px"})}function r(){var r=t.containW/t.width,i;r>1&&(r=1);i=t.containH/t.height;i>1&&(i=1);n(".brightbox").css({width:t.$preview.w*r+"px",height:t.$preview.h*i+"px"})}function u(){var r=parseFloat(f[0].style.width),u=parseFloat(f[0].style.height),n=-t.$preview.w*t.left/t.width,i=-t.$preview.h*t.top/t.height;n<=0?n=0:r+n>=t.$preview.w&&(n=t.$preview.w-r);i<=0?i=0:u+i>=t.$preview.h&&(i=t.$preview.h-u);f.css({left:n+"px",top:i+"px"});c()}i();r();u()};n(".bigButton").click(function(){t.Scale(t.options.scaleNum)});n(".smallButton").click(function(){t.Scale(1/t.options.scaleNum)});n(".closeButton").click(function(){t.destroy()})};f.prototype.initdraw=function(){for(var t,i=this,n=0;n<i.imgLevels[0].length;n++)for(t=0;t<i.imgLevels[0][n].length;t++)(function(n,t){i.imgload(0,n,t)})(n,t)};f.prototype.setCss=function(){function i(n,t){n.css("transform",t);n.css("-ms-transform",t);n.css("-webkit-transform",t);n.css("-moz-transform",t)}var n=this,t;n.width<n.containW?(t=n.containW-n.width,n.left<0?n.left=0:n.left>t?n.left=t:1):(t=n.width-n.containW+n.options.whiteBorderSize,n.left>n.options.whiteBorderSize?n.left=n.options.whiteBorderSize:n.left<-t?n.left=-t:1);n.height<n.containH?(t=n.containH-n.height,n.top<0?n.top=0:n.top>t?n.top=t:1):(t=n.height-n.containH+n.options.whiteBorderSize,n.top>n.options.whiteBorderSize?n.top=n.options.whiteBorderSize:n.top<-t?n.top=-t:1);n.options.mode!="canvas"&&(n.canTransform?i(n.$canvas,"matrix("+n.width/n.options.fullWidth+",0,0,"+n.height/n.options.fullHeight+","+n.left+","+n.top+")"):(n.canvas.style.width=n.width+"px",n.canvas.style.height=n.height+"px",n.canvas.style.top=n.top+"px",n.canvas.style.left=n.left+"px"));n.options.thumbnail&&n.setThumbnail()};f.prototype.draw=function(n){var t=this,f=t.options.fullWidth/t.width,i=n||t.curLevel,r,u;for(t.options.mode=="canvas"&&i<=t.curLevel&&t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.curLevel=i,r=0;r<t.imgLevels[i].length;r++)for(u=0;u<t.imgLevels[i][r].length;u++)t.rectTest(t.imgLevels[i][r][u],{x:-t.left*f,y:-t.top*f,w:t.containW*f,h:t.containH*f})&&t.imgload(i,r,u)};f.prototype.imgload=function(n,t,i){var r=this;typeof r.imgs[n][t][i].alreadyLoad=="undefined"?(r.imgs[n][t][i]=new Image,r.imgs[n][t][i].onload=function(){if(r.options.mode=="canvas"){var u=r.width/r.options.fullWidth;r.ctx.drawImage(this,r.imgLevels[n][t][i].x*u+r.left,r.imgLevels[n][t][i].y*u+r.top,r.imgLevels[n][t][i].w*u,r.imgLevels[n][t][i].h*u)}else this.style.position="absolute",this.style.width=r.imgLevels[n][t][i].w+"px",this.style.height=r.imgLevels[n][t][i].h+"px",this.style.top=r.imgLevels[n][t][i].y+"px",this.style.left=r.imgLevels[n][t][i].x+"px",this.style.zIndex=n,r.canvas.appendChild(this);this.alreadyLoad=!0},r.imgs[n][t][i].src=r.imgLevels[n][t][i].src):r.imgs[n][t][i].alreadyLoad==!0&&r.options.mode=="canvas"&&r.imgs[n][t][i].onload()};f.prototype.Scale=function(n,t){var i=this,u;i.scale*n>i.maxScaleNum?n=i.maxScaleNum/i.scale:i.scale*n<1?n=1/i.scale:1;var r=t||{x:i.containW/2,y:i.containH/2},f=r.x-i.width*n*(r.x-i.left)/i.width,e=r.y-i.height*n*(r.y-i.top)/i.height;i.width=i.width*n;i.height=i.height*n;i.scale=i.scale*n;u=Math.ceil(Math.log(i.scale)/Math.log(i.options.scaleNum));u>i.LevelMax?u=i.LevelMax:u<0&&(u=0);i.options.mode=="canvas"&&u>=i.curLevel&&n>1&&i.ctx.drawImage(i.canvas,r.x-r.x*n,r.y-r.y*n,i.canvas.width*n,i.canvas.height*n);i.left=f;i.top=e;i.setCss();i.floorLevelTimeout!="undefined"&&(clearTimeout(i.floorLevelTimeout),i.floorLevelTimeout="undefined");i.floorLevelTimeout=setTimeout(function(){i.draw(u)},300)};f.prototype.rectTest=function(n,t){return n.x<t.x+t.w&&n.x+n.w>t.x&&n.y<t.y+t.h&&n.y+n.h>t.y};f.prototype.resize=function(n){if(n.options.mode!="canvas"){var i=n.$layer.width(),r=n.$layer.height(),t=n.containW/i;n.width=n.width*t;n.height=n.height*t;n.left=n.left+(i-n.containW)/2-(n.width-n.width/t)/2;n.top=n.top+(r-n.containH)/2-(n.height-n.height/t)/2;n.containW=i;n.containH=r;n.setCss();n.draw()}};f.prototype.destroy=function(){var n=this;n.$layer.off("mousedown touchstart mousewheel DOMMouseScroll");n.$canvas.remove();n.options.thumbnail&&n.$thumbnail.remove();n.closed()};f.prototype.closed=function(){console.log("closed")};f.prototype.getxy=function(n){var t;if(t=typeof n.originalEvent!="undefined"?n.originalEvent:n,typeof t.targetTouches!="undefined"){if(t.targetTouches.length>0)return{x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY};if(t.changedTouches.length>0)return{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}}else{if(typeof t.clientX!="undefined")return{x:t.clientX,y:t.clientY};if(typeof t.pageX!="undefined")return{x:t.pageX,y:t.pageY}}}})(jQuery,window,document);